# Распознавание автомобильных номеров RU-региона на основе искусственного интеллекта

## Описание данных

В качестве исходных данных для решения задачи был использован датасет https://disk.yandex.ru/d/NANSgQklgRElog , состоящий из более чем 25 тысяч изображений автомобилей для обучения моделей и более чем 3 тысяч изображений для тестирования обученных моделей. Вместе с датасетом прилагается файл train.json, содержащий разметку для тестовой части.

## Выбор и обоснование метрик

В качестве метрики на этапе детекции была выбрана [IoU](https://medium.com/analytics-vidhya/iou-intersection-over-union-705a39e7acef) - метрика, рассчитываемая как отношение площади пересечения истинного и предсказанного bounding box'ов к площади их объединения.

![IoU](https://habrastorage.org/r/w1560/webt/hg/xi/zj/hgxizjtbx6vlispj9rl8nzfvhsu.png)

Данные по подбору гиперпараметров представлены в таблице ниже.

| Модель | Оптимизатор | Learning rate | IOU |
| --- | --- | --- | --- |
| FastRCNN | SGD | 0.005 | 0.8144 |
| FastRCNN | SGD | 0.001 | 0.843 |
| FastRCNN | Adam | 0.005 | 0.8123 |
| FastRCNN | Adam | 0.001 | 0.838 |

В качестве метрики на этапе распознания текста на автомобильных номерах было выбрано [расстояние Левенштейна](https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D1%81%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5_%D0%9B%D0%B5%D0%B2%D0%B5%D0%BD%D1%88%D1%82%D0%B5%D0%B9%D0%BD%D0%B0) - метрика, измеряющая по модулю разность между двумя последовательностями символов. Она определяется как минимальное количество односимвольных операций (вставки, удаления, замены), необходимых для превращения одной последовательности символов в другую.

## Порядок запуска:

### Обучение моделей

1. Загрузите датасет для обучения моделей https://disk.yandex.ru/d/NANSgQklgRElog

2. Обучите модель обнаружения автомобильных номеров - train_detection_model.py

    При запуске обучающего скрипта из командной строки могут быть указаны следующие параметры:

        -h, --help              Показать данное сообщение и выйти
        -data DATA              Путь к обучающему датасету
        -output OUTPUT          Путь для сохранения модели
        -num_epochs NUM_EPOCHS  Количество обучающих эпох
        -batch_size BATCH_SIZE  Размер бача
        -exp_name EXP_NAME      Название файла с моделью

3. Создайте датасет для обучения модели распознавания текста на номерах - create_ocr_dataset.py

     При запуске скрипта из командной строки могут быть указаны следующие параметры:

        -h, --help      Показать данное сообщение и выйти
        -data DATA      Путь к необработанному датасету
        -output OUTPUT  Путь для сохранения датасета

4. Обучите модель для распознавания текста - train_recognition_model.py

    При запуске обучающего скрипта из командной строки могут быть указаны следующие параметры:

        -h, --help              Показать данное сообщение и выйти
        -data DATA              Путь к обучающему датасету
        -output OUTPUT          Путь для сохранения модели
        -num_epochs NUM_EPOCHS  Количество обучающих эпох
        -batch_size BATCH_SIZE  Размер бача
        -exp_name EXP_NAME      Название файла с моделью

5. Создайте языковую модель для beamsearch - create_language_model.py

### Запуск пайплайна

1. Запустите инференс - inference.py

    Данный скрипт обрабатывает одно изображение. Результат работы пайплайна выводится в консоль и сохраняется в выбранной директории в формате jpg. 
    
    При запуске скрипта из командной строки могут быть указаны следующие параметры:

        -h, --help                              Показать данное сообщение и выйти
        -img IMG                                Путь к изображению
        -output OUTPUT                          Путь для сохранения обработанного изображения
        -detection_model DETECTION_MODEL        Путь к модели детекции автомобильных номеров
        -recognition_model RECOGNITION_MODEL    Путь к модели распознания текста на номерах

## Пример инференса:

Вывод в консоль при запуске пайплайна для [тестового изображения](test.jpg)

Y654BE77 [ 96.55244 434.03857 185.2982  480.91248] p=0.9996976852416992

Сохраненный в виде изображения результат:

![Example](https://github.com/PetrovitchSharp/DL_CarPlates_23/blob/dev/inference_example.jpg)

## Производительность:

Рассчет производительности был выполнен на следующих комплектующих:

GPU: NVIDIA GeForce RTX 3090 (24 GB, 1.70 GHz, 10496 CUDA cores)

CPU: AMD Ryzen 9 5900X (12 cores, 24 Threads, 3.7 GHz) 

### Обучение:

Модель детекции: 15 min/epoch

Модель распознания текста: 1.25 min/epoch

### Инференс:

На GPU: 0.57 sec/image

На CPU: 1.33 sec/image
